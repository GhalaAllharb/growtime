<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GrowTime</title>
<meta name="description" content="GrowTime — ازرع وقتك … واحصد إنجازاتك. مؤقّت تركيز مع حديقة إنجازات تُحفظ محليًا.">
<style>
  :root{
    --bg: #0b111a;
    --card: #0f1b2a;
    --border:#1a2c42;
    --text: #f2f7ff;
    --muted:#9fb2cc;
    --accent:#00c48c;
    --accent2:#7d8bff;
    --warn:#ff6b6b;
    --ringBase:#0c2a29;
    --ringFill:#00c48c;
    --ringFill2:#54ffd1;
    --grad1: radial-gradient(1200px 700px at 50% -200px, #122848 0%, #0b111a 60%);
  }
  *{box-sizing:border-box}
  body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--text); background: var(--grad1); padding:18px}
  .app{max-width:980px; margin:0 auto}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px}
  .brand{display:flex; align-items:center; gap:10px}
  .logo{width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:linear-gradient(135deg, var(--accent), var(--ringFill2))}
  .logo span{font-size:22px;}
  h1{margin:0; font-size:22px;}
  .slogan{color:#cfe8ff; opacity:.9; font-size:14px}
  .tabs{display:flex; gap:8px; margin:14px 0}
  .tab{background:transparent; border:1px solid var(--border); color:var(--text); padding:8px 12px; border-radius:999px; cursor:pointer}
  .tab.active{background:linear-gradient(90deg, var(--accent), var(--ringFill2)); color:#052016; border-color:transparent; font-weight:700}
  .card{background:linear-gradient(180deg, var(--card), #0d1928); border:1px solid var(--border); padding:16px; border-radius:14px; margin-bottom:14px;}
  .muted{color:var(--muted); font-size:13px}
  .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .btn{background:#0e1a2c; border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer}
  .btn.primary{background:linear-gradient(90deg, var(--accent), var(--ringFill2)); color:#06231b; border:0}
  .btn.warn{background:transparent; border-color:var(--warn); color:#ffd8d8}
  label{display:flex; flex-direction:column; gap:6px; color:#d7e7ff}
  input[type="range"]{width:100%}
  input[type="text"]{background:#0d1726; border:1px solid var(--border); color:#fff; padding:10px 12px; border-radius:10px; outline:none}
  .grid{display:grid; gap:12px}
  .grid-2{grid-template-columns: 1.2fr .8fr}
  @media(max-width:880px){ .grid-2{grid-template-columns: 1fr} }

  .timer-area{display:flex; gap:18px; align-items:center; flex-wrap:wrap}
  .ring{width:260px; height:260px; border-radius:50%; display:grid; place-items:center; position:relative; box-shadow: inset 0 0 40px rgba(0,0,0,.35), 0 10px 40px rgba(0,196,140,.22)}
  .ring .inner{width:160px; height:160px; border-radius:50%; display:grid; place-items:center; background:radial-gradient(closest-side, #0b1522 70%, #091420); box-shadow: inset 0 10px 25px rgba(0,0,0,.55)}
  .time-big{font-size:40px;}
  .time-sub{color:var(--muted); margin-top:6px}
  .state{display:inline-block; border:1px solid var(--border); padding:6px 10px; border-radius:999px; margin-top:8px}

  .hint{margin-top:12px; font-size:14px; color:#cfe8ff; text-align:center}

  /* Garden */
  .garden-grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:12px; margin-top:10px}
  .tile{position:relative; background:linear-gradient(180deg, #0c1825, #0b131b); border:1px solid var(--border); border-radius:12px; min-height:120px; display:grid; place-items:center; padding:10px; overflow:hidden}
  .plant-emoji{font-size:42px; filter: drop-shadow(0 8px 14px rgba(0,0,0,.45))}
  .plant-dead{filter: grayscale(1) opacity(.6)}
  .tile small{color:var(--muted)}
  .soil{position:absolute; left:8px; right:8px; bottom:8px; height:22px; border-radius:10px; background:linear-gradient(180deg,#163025,#0a120e); border:1px solid #1b3b2c}

  /* Modal */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:9998}
  .modal .box{background:linear-gradient(180deg,#0e1a2c,#0a1524); border:1px solid var(--border); border-radius:16px; padding:18px; width:min(520px, 92vw); text-align:center}
  .box h3{margin-top:0}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="brand">
      <div class="logo"><span>🌿</span></div>
      <div>
        <h1>GrowTime</h1>
        <div class="slogan">ازرع وقتك … واحصد إنجازاتك</div>
      </div>
    </div>
    <nav class="tabs" role="tablist">
      <button class="tab active" data-target="#focus">التركيز</button>
      <button class="tab" data-target="#garden">حديقتك</button>
    </nav>
  </header>

  <section id="focus" class="page">
    <div class="card grid grid-2">
      <div>
        <label>اختر مدة الجلسة: <span id="durLabel">25 دقيقة</span></label>
        <input id="duration" type="range" min="5" max="120" value="25" />
        <div class="muted">الحد الأدنى 5 دقائق — الحد الأقصى ساعتان</div>
        <label style="margin-top:14px">ما الذي ستُنجزه الآن؟ (اختياري)</label>
        <input id="taskName" type="text" placeholder="">
        <div class="controls" style="margin-top:12px">
          <button class="btn primary" id="btnStart">ابدأ الجلسة</button>
          <button class="btn" id="btnPause">إيقاف/استئناف</button>
          <button class="btn warn" id="btnCancel">إلغاء</button>
          <div style="flex:1"></div>
          <span class="muted">الحالة: <span id="stateLabel" class="state">جاهز</span></span>
        </div>
        <div class="hint">المستقبل لا يُختار، بل يُصنع بعاداتك… استثمر وقتك.</div>
      </div>

      <div class="timer-area">
        <div class="ring" id="ring" aria-hidden="true">
          <div class="inner">
            <div class="time-big" id="timeBig">25:00</div>
            <div class="time-sub" id="timeSub">باقي 25 دقيقة</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="garden" class="page" style="display:none">
    <div class="card">
      <h3 style="margin-top:0">حديقتك</h3>
      <div id="gardenGrid" class="garden-grid" aria-live="polite"></div>
      <div class="controls" style="margin-top:10px">
        <button class="btn" id="btnExport">تصدير (JSON)</button>
        <label class="btn" style="cursor:pointer">استيراد<input id="fileImport" type="file" accept="application/json" hidden></label>
        <button class="btn warn" id="btnClear">مسح الحديقة</button>
      </div>
    </div>
  </section>

  <div class="modal" id="endModal" role="dialog" aria-modal="true">
    <div class="box">
      <h3 id="endTitle">مبروك! أنجزت جلستك 🎉</h3>
      <p id="endMsg" class="muted">استمر … ازرع وقتك، واحصد إنجازاتك!</p>
      <div class="controls" style="justify-content:center; margin-top:10px">
        <button class="btn primary" id="goGarden">اذهب للحديقة</button>
        <button class="btn" id="closeModal">إغلاق</button>
      </div>
    </div>
  </div>
</div>

<script>
// ====== تخزين محلي ======
const STORE='growtime_final_v1';
let DB = load();
function load(){ try{ return JSON.parse(localStorage.getItem(STORE)) || {garden:[]} }catch(e){ return {garden:[]} } }
function save(){ localStorage.setItem(STORE, JSON.stringify(DB)); }

// ====== عناصر واجهة ======
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const durationRange=$('#duration'), durLabel=$('#durLabel'), timeBig=$('#timeBig'), timeSub=$('#timeSub'), ring=$('#ring');
const stateLabel=$('#stateLabel');
const taskName=$('#taskName');
const endModal=$('#endModal');

// ====== حالة المؤقت ======
let totalSec=parseInt(durationRange.value,10)*60;
let leftSec=totalSec;
let timer=null;
let running=false;

// ====== مظهر الحلقة ======
const plantStages=['🌱','🌿','🌳'];

// ====== تبويبات ======
$$('.tab').forEach(b=>{
  b.addEventListener('click', ()=>{
    $$('.tab').forEach(x=>x.classList.remove('active')); b.classList.add('active');
    $$('.page').forEach(p=>p.style.display='none'); $(b.dataset.target).style.display='block';
    if(b.dataset.target==='#garden') renderGarden();
  });
});

// ====== وظائف المؤقت ======
function fmt(s){ s=Math.max(0,Math.round(s)); const m=(s/60|0).toString().padStart(2,'0'); const sec=(s%60).toString().padStart(2,'0'); return m+':'+sec; }
function updateDurLabel(){ durLabel.textContent=durationRange.value+' دقيقة'; totalSec=parseInt(durationRange.value,10)*60; leftSec=totalSec; renderTimer(); }
durationRange.addEventListener('input', updateDurLabel);

function renderTimer(){
  timeBig.textContent=fmt(leftSec);
  timeSub.textContent=`باقي ${Math.ceil(leftSec/60)} دقيقة`;
  const progress=1-(leftSec/totalSec||0);
  const deg=Math.max(0,Math.min(360,Math.round(progress*360)));
  ring.style.background=`conic-gradient(var(--ringFill) ${deg}deg, var(--ringFill2) ${deg}deg, var(--ringBase) 0deg)`;
  let plant=document.querySelector('.centerPlant');
  if(!plant){ plant=document.createElement('div'); plant.className='centerPlant'; plant.style.position='absolute'; plant.style.fontSize='36px'; ring.appendChild(plant); }
  const stageIdx=progress>=0.9?2:(progress>=0.4?1:0);
  plant.textContent=plantStages[stageIdx];
}

function startSession(){
  if(running){ alert('الجلسة بالفعل جارية'); return; }
  if(leftSec<=0) leftSec=totalSec;
  running=true;
  timer=setInterval(()=>{
    leftSec-=1;
    renderTimer();
    if(leftSec<=0){ completeSession(); }
  },1000);
  stateLabel.textContent='جارية';
}
function pauseResume(){
  if(!running){
    if(leftSec<=0) return;
    running=true;
    timer=setInterval(()=>{
      leftSec-=1; renderTimer();
      if(leftSec<=0){ completeSession(); }
    },1000);
    stateLabel.textContent='جارية';
  }else{
    running=false; clearInterval(timer); timer=null;
    stateLabel.textContent='موقوفة';
  }
}
function cancelSession(){
  if(!running && leftSec===totalSec){ alert('لا توجد جلسة لإلغائها'); return; }
  if(!confirm('إلغاء الجلسة؟ سيتم إضافة نبتة ذابلة.')) return;
  recordPlant(false, Math.max(1, Math.round((totalSec-leftSec)/60)));
  resetTimer();
  alert('تم الإلغاء — نبتة ذابلة 🌧️');
}

function completeSession(){
  clearInterval(timer); timer=null; running=false;
  recordPlant(true, Math.round(totalSec/60));
  showEndModal();
  resetTimer();
}

function resetTimer(){
  leftSec=totalSec=parseInt(durationRange.value,10)*60;
  renderTimer();
  stateLabel.textContent='جاهز';
}

function recordPlant(success, minutes){
  DB.garden.push({success, minutes, task: taskName.value.trim(), date: new Date().toISOString()});
  save();
}

// ====== المودال ======
function showEndModal(){
  $('#endTitle').textContent='مبروك! أنجزت جلستك 🎉';
  $('#endMsg').textContent='استمر … ازرع وقتك، واحصد إنجازاتك!';
  endModal.style.display='flex';
}
$('#goGarden').addEventListener('click', ()=>{ endModal.style.display='none'; document.querySelector('[data-target="#garden"]').click(); });
$('#closeModal').addEventListener('click', ()=> endModal.style.display='none');

// ====== الحديقة ======
function renderGarden(){
  const g=$('#gardenGrid'); g.innerHTML='';
  if(!DB.garden.length){ g.innerHTML='<div class="muted">لا توجد نباتات بعد — ابدأ جلسة لترى حديقتك 🌿</div>'; return; }
  DB.garden.slice().reverse().forEach(p=>{
    const tile=document.createElement('div'); tile.className='tile';
    const emoji=document.createElement('div'); emoji.className='plant-emoji'; emoji.textContent=p.success?'🌳':'🥀';
    if(!p.success) emoji.classList.add('plant-dead');
    const meta=document.createElement('small'); meta.textContent=(p.success?'مكتملة':'ذابلة')+' • '+p.minutes+' د';
    const task=document.createElement('small'); task.textContent=p.task||'بدون عنوان';
    const soil=document.createElement('div'); soil.className='soil';
    tile.appendChild(emoji); tile.appendChild(meta); tile.appendChild(task); tile.appendChild(soil);
    g.appendChild(tile);
  });
}

// ====== تصدير/استيراد/مسح ======
$('#btnExport')?.addEventListener('click', ()=>{
  const blob=new Blob([JSON.stringify(DB,null,2)], {type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='growtime_garden.json'; a.click(); URL.revokeObjectURL(url);
});
$('#fileImport')?.addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  try{ const text=await f.text(); const json=JSON.parse(text);
    if(!json.garden) throw new Error();
    DB=json; save(); renderGarden(); alert('تم الاستيراد');
  }catch(err){ alert('ملف غير صالح'); }
});
$('#btnClear')?.addEventListener('click', ()=>{
  if(confirm('متأكد؟ سيتم مسح الحديقة نهائيًا.')){ DB.garden=[]; save(); renderGarden(); }
});

// ====== أزرار التحكم ======
document.getElementById('btnStart').addEventListener('click', startSession);
document.getElementById('btnPause').addEventListener('click', pauseResume);
document.getElementById('btnCancel').addEventListener('click', cancelSession);

// ====== تهيئة ======
updateDurLabel(); renderTimer(); renderGarden();
</script>
</body>
</html>
